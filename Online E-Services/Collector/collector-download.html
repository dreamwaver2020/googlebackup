<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Foot Fails â€” Records Viewer</title>

<style>
  body{
    font-family: Arial;
    background:#f3f6ff;
    margin:0;
    padding:12px;
  }
  .card{
    background:white;
    padding:14px;
    border-radius:10px;
    box-shadow:0 4px 15px rgba(0,0,0,0.1);
    max-width:960px;
    margin:auto;
  }
  table{
    width:100%;
    border-collapse:collapse;
  }
  th, td{
    border:1px solid #e5e9ff;
    padding:8px;
    font-size:14px;
  }
  th{
    background:#eaf3ff;
  }
  .pager{
    display:flex;
    justify-content:center;
    gap:12px;
    margin-top:14px;
  }
  .btn{
    padding:7px 12px;
    border:none;
    border-radius:6px;
    background:#007bff;
    color:white;
    cursor:pointer;
    font-size:14px;
  }
  .btn.secondary{
    background:#6c757d;
  }
  .btn:disabled{
    background:#9bbcff;
  }
</style>
</head>

<body>

<div class="card">

  <h2 style="text-align:center;margin-top:0;">ğ…ğ¨ğ¨ğ­ ğŸğšğ¥ğ¥ ğˆğ§ğªğ®ğ¢ğ«ğ² ğ‘ğğ©ğ¨ğ«ğ­</h2>
<h2 style="text-align:center;margin-top:0;">ğ“¢ğ“½ğ“ªğ“½ğ“®ğ“¶ğ“®ğ“·ğ“½ ğ“–ğ“®ğ“·ğ“®ğ“»ğ“ªğ“½ğ“¸ğ“»</h2>
  <!-- Search + Export Buttons -->
  <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
      <input id="search" type="text" placeholder="Search Name / Phone"
            style="padding:8px;width:220px;">
      <div>
        <button id="csvBtn" class="btn">ğŸ§¾Export CSV</button>
        <button id="pdfBtn" class="btn secondary">ğŸ“šExport PDF</button>
      </div>
  </div>

  <!-- Table -->
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Name</th>
        <th>Address</th>
        <th>Phone</th>
        <th>Exchange</th>
        <th>Type</th>
        <th>Status</th>
        <th>Remarks</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <!-- Pagination -->
  <div class="pager">
    <button id="prevBtn" class="btn">â¬… Prev Page</button>
    <span id="info">Page 1</span>
    <button id="nextBtn" class="btn">Next Page â¡</button>
  </div>

</div>

<script>
const KEY = "foot_fails_records";
let perPage = 10;
let currentPage = 1;

/* ---- Convert Date Safely ---- */
function safeDate(d){
  let t = new Date(d);
  return isNaN(t.getTime()) ? new Date(0) : t;
}

/* ---- Fetch descending by DATE ---- */
function getData(){
  let arr = JSON.parse(localStorage.getItem(KEY) || "[]");

  arr.sort((a,b)=> safeDate(b.date) - safeDate(a.date)); // DESCENDING DATE

  return arr;
}

function render(){
  let q = document.getElementById("search").value.toLowerCase();
  let all = getData().filter(r =>
    (r.name || "").toLowerCase().includes(q) ||
    (r.phone || "").includes(q)
  );

  let total = all.length;
  let totalPages = Math.max(1, Math.ceil(total/perPage));
  if(currentPage > totalPages) currentPage = totalPages;

  let page = all.slice((currentPage-1)*perPage, currentPage*perPage);
  let tb = document.getElementById("tbody");
  tb.innerHTML = "";

  page.forEach(r=>{
    tb.innerHTML += `
      <tr>
        <td>${r.date || ""}</td>
        <td>${r.name}</td>
        <td>${r.address}</td>
        <td>${r.phone}</td>
        <td>${r.exchange}</td>
        <td>${r.ctype}</td>
        <td>${r.status}</td>
        <td>${r.remarks}</td>
      </tr>
    `;
  });

  document.getElementById("info").textContent =
      "Page " + currentPage + " of " + totalPages;

  document.getElementById("prevBtn").disabled = currentPage === 1;
  document.getElementById("nextBtn").disabled = currentPage === totalPages;
}

document.getElementById("prevBtn").onclick = ()=>{
  if(currentPage > 1){ currentPage--; render(); }
};
document.getElementById("nextBtn").onclick = ()=>{
  currentPage++; render();
};
document.getElementById("search").oninput = ()=>{
  currentPage = 1;
  render();
};


/* ---- CSV EXPORT ---- */
document.getElementById("csvBtn").onclick = ()=>{
  let arr = getData();
  if(arr.length === 0){ alert("No data to export"); return; }

  let csv = "Date,Name,Address,Phone,Exchange,Type,Status,Remarks\n";
  arr.forEach(r=>{
    csv += `"${r.date}","${r.name}","${r.address}","${r.phone}","${r.exchange}","${r.ctype}","${r.status}","${r.remarks}"\n`;
  });

  let blob = new Blob([csv], {type:"text/csv"});
  let url = URL.createObjectURL(blob);
  let a = document.createElement("a");
  a.href = url;
  a.download = "records.csv";
  a.click();
  URL.revokeObjectURL(url);
};


/* ---- PDF EXPORT ---- */
document.getElementById("pdfBtn").onclick = ()=>{
  let arr = getData();
  if(arr.length === 0){ alert("No records"); return; }

  let w = window.open("");
  w.document.write(`
    <html><head><title>Foot Fails PDF</title></head><body>
    <h2>Foot Fails / Inquiry Records</h2>
    <table border="1" style="width:100%; border-collapse:collapse;">
      <tr>
        <th>Date</th><th>Name</th><th>Address</th><th>Phone</th>
        <th>Exchange</th><th>Type</th><th>Status</th><th>Remarks</th>
      </tr>
      ${
        arr.map(r=>`
          <tr>
            <td>${r.date}</td>
            <td>${r.name}</td>
            <td>${r.address}</td>
            <td>${r.phone}</td>
            <td>${r.exchange}</td>
            <td>${r.ctype}</td>
            <td>${r.status}</td>
            <td>${r.remarks}</td>
          </tr>
        `).join("")
      }
    </table>
    </body></html>
  `);
  w.document.close();
  w.print();
};

render();
</script>

</body>
</html>
