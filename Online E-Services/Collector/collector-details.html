<!DOCTYPE html>
<html lang="ne">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Foot Fails / Inquiry Form</title>

  <style>
    :root{
      --primary:#007bff;
      --muted:#f4f8ff;
      --card:#ffffff;
      --shadow:rgba(0,0,0,0.08);
    }
    body{
      font-family: Arial, Helvetica, sans-serif;
      background: linear-gradient(180deg,#e8f6ff, #f8fbff);
      padding:12px;
      margin:0;
    }
    .wrap{
      max-width:920px;
      margin:12px auto;
      padding:14px;
    }
    .card{
      background:var(--card);
      border-radius:12px;
      box-shadow:0 6px 22px var(--shadow);
      padding:14px;
      margin-bottom:14px;
    }
    h2{
      font-size:20px;
      margin:6px 0 12px;
      text-align:center;
      color:#003366;
    }
    .form-grid{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
    }
    @media(min-width:820px){
      .form-grid{ grid-template-columns:1fr 1fr; gap:14px; }
    }
    .block{
      background:var(--muted);
      padding:10px;
      border-radius:10px;
    }
    label{
      display:block;
      font-weight:600;
      font-size:13px;
      margin-bottom:6px;
      color:#113;
    }
    input[type="text"], input[type="date"], select, textarea{
      width:100%;
      padding:9px 10px;
      border-radius:8px;
      border:1px solid #cfdce9;
      font-size:14px;
      box-sizing:border-box;
    }
    textarea{ resize:vertical; height:60px; }
    .radio-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .controls{
      display:flex;
      gap:8px;
      margin-top:8px;
      flex-wrap:wrap;
    }
    .btn{
      border:0;
      padding:10px 12px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      background:var(--primary);
      color:white;
    }
    .btn.secondary{ background:#6c757d; }
    .btn.small{ padding:7px 10px; font-size:13px; }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }
    th, td{
      padding:8px 10px;
      border:1px solid #e6eef9;
      text-align:left;
    }
    th{ background:#eaf6ff; }
    .pager{
      display:flex;
      justify-content:center;
      gap:10px;
      margin-top:12px;
    }
  </style>
</head>

<body>
<div class="wrap">

  <!-- ENTRY FORM -->
  <div class="card">
    <h2>ğ…ğ¨ğ¨ğ­ ğŸğšğ¥ğ¥ / ğˆğ§ğªğ®ğ¢ğ«ğ² ğ…ğ¨ğ«ğ¦</h2>
    <h2>ğ’«ğ“ğ‘’ğ’¶ğ“ˆğ‘’ ğ‘’ğ“ƒğ“‰ğ‘’ğ“‡ ğ’´â˜¯ğ“Šğ“‡ ğ’¹ğ’¶ğ“‰ğ’¶</h2>

    <div class="form-grid">
      <div class="block">

        <label>Date</label>
        <input id="date" type="date">

        <label>Name</label>
        <input id="name" type="text">

        <label>Address</label>
        <input id="address" type="text">

        <label>Phone Number</label>
        <input id="phone" type="text">

        <label>Exchange Type</label>
        <select id="exchange">
          <option>Cash</option>
          <option>Exchange</option>
          <option>Cash & Exchange</option>
          <option>Finance</option>
        </select>

      </div>

      <div class="block">

        <label>Customer Type</label>
        <div class="radio-row">
          <label><input type="radio" name="ctype" value="Hot" checked> Hot</label>
          <label><input type="radio" name="ctype" value="Warm"> Warm</label>
          <label><input type="radio" name="ctype" value="Cold"> Cold</label>
          <label><input type="radio" name="ctype" value="Aggressive"> Aggressive</label>
        </div>

        <label>Status</label>
        <div class="radio-row">
          <label><input type="radio" name="status" value="Active" checked> Active âœ”</label>
          <label><input type="radio" name="status" value="Pending"> Pending âœ—</label>
        </div>

        <label>Remarks</label>
        <textarea id="remarks"></textarea>

      </div>
    </div>

    <div class="controls">
      <button id="saveBtn" class="btn">ğŸ’¾Save</button>
      <button id="clearBtn" class="btn secondary">ğŸ§¹Clear</button>

      <div style="flex:1"></div>
      <div>Total Records: <b id="totalCount">0</b></div>
    </div>
  </div>

  <!-- TABLE -->
  <div class="card">

    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
      <input id="searchInput" type="text" placeholder="Search Name / Phone" style="padding:8px;width:220px;">
      <div>
        <button id="exportCsv" class="btn small">ğŸ“ƒExport CSV</button>
        <button id="exportPdf" class="btn small secondary">ğŸ“Export PDF</button>
      </div>
    </div>

    <table id="table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Name</th>
          <th>Address</th>
          <th>Phone</th>
          <th>Exchange</th>
          <th>Type</th>
          <th>Status</th>
          <th>Remarks</th>
          <th width="120">Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="pager">
      <button id="prevBtn" class="btn small secondary">Prev</button>
      <span id="pageInfo">Page 1</span>
      <button id="nextBtn" class="btn small secondary">Next</button>
    </div>

  </div>

</div>

<script>
/* --- state & element refs --- */
const KEY = "foot_fails_records";
let perPage = 10;
let currentPage = 1;
let editingId = null;

const dateEl = document.getElementById("date");
const nameEl = document.getElementById("name");
const addressEl = document.getElementById("address");
const phoneEl = document.getElementById("phone");
const exchangeEl = document.getElementById("exchange");
const remarksEl = document.getElementById("remarks");

const saveBtn = document.getElementById("saveBtn");
const clearBtn = document.getElementById("clearBtn");
const searchInput = document.getElementById("searchInput");
const exportCsv = document.getElementById("exportCsv");
const exportPdf = document.getElementById("exportPdf");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const pageInfo = document.getElementById("pageInfo");
const totalCountEl = document.getElementById("totalCount");
const tbody = document.querySelector("#table tbody");

/* --- helpers --- */
function todayISO(){
  const d = new Date();
  return d.toISOString().slice(0,10);
}
function parseDateSafe(s){
  if(!s) return new Date(0);
  const t = new Date(s);
  return isNaN(t.getTime()) ? new Date(0) : t;
}

function getData(){
  try{
    return JSON.parse(localStorage.getItem(KEY) || "[]");
  }catch(e){
    return [];
  }
}
function setData(arr){
  // sort descending by date (newest first)
  arr.sort((a,b)=> parseDateSafe(b.date) - parseDateSafe(a.date));
  localStorage.setItem(KEY, JSON.stringify(arr));
}

/* --- clear form --- */
function clearForm(){
  editingId = null;
  dateEl.value = "";
  nameEl.value = "";
  addressEl.value = "";
  phoneEl.value = "";
  exchangeEl.value = "Cash";
  remarksEl.value = "";
  const ctypeHot = document.querySelector('input[name="ctype"][value="Hot"]');
  const statusActive = document.querySelector('input[name="status"][value="Active"]');
  if(ctypeHot) ctypeHot.checked = true;
  if(statusActive) statusActive.checked = true;
}
clearBtn.addEventListener("click", clearForm);

/* --- save handler (fixed) --- */
saveBtn.addEventListener("click", ()=>{
  // ensure date exists; if not, default to today
  const dateVal = dateEl.value ? dateEl.value : todayISO();

  const rec = {
    date: dateVal,
    name: nameEl.value.trim(),
    address: addressEl.value.trim(),
    phone: phoneEl.value.trim(),
    exchange: exchangeEl.value,
    ctype: (document.querySelector('input[name="ctype"]:checked')||{}).value || "Hot",
    status: (document.querySelector('input[name="status"]:checked')||{}).value || "Active",
    remarks: remarksEl.value.trim(),
    id: editingId || (Date.now() + "_" + Math.random().toString(36).slice(2,9))
  };

  // validation simple: at least name or phone
  if(!rec.name && !rec.phone){
    alert("à¤•à¥ƒà¤ªà¤¯à¤¾ Name à¤µà¤¾ Phone à¤à¤‰à¤Ÿà¤¾ à¤­à¤°à¥à¤¨à¥à¤¹à¥‹à¤¸à¥à¥¤");
    return;
  }

  const arr = getData();
  if(editingId){
    const idx = arr.findIndex(x=> x.id === editingId);
    if(idx >= 0) arr[idx] = rec;
  } else {
    arr.push(rec);
  }

  setData(arr);
  clearForm();
  currentPage = 1;
  render();
});

/* --- edit / delete functions --- */
window.editRecord = function(id){
  const r = getData().find(x=> x.id === id);
  if(!r) return;
  editingId = id;
  dateEl.value = r.date || todayISO();
  nameEl.value = r.name || "";
  addressEl.value = r.address || "";
  phoneEl.value = r.phone || "";
  exchangeEl.value = r.exchange || "Cash";
  const ctypeEl = document.querySelector(`input[name="ctype"][value="${r.ctype}"]`);
  const statusEl = document.querySelector(`input[name="status"][value="${r.status}"]`);
  if(ctypeEl) ctypeEl.checked = true;
  if(statusEl) statusEl.checked = true;
  remarksEl.value = r.remarks || "";
  window.scrollTo({top:0, behavior:"smooth"});
};

window.deleteRecord = function(id){
  if(!confirm("âš ï¸Warning: Delete this record Permanently?")) return;
  const arr = getData().filter(x=> x.id !== id);
  setData(arr);
  // if current page becomes empty after delete, step back a page
  const total = getData().length;
  const totalPages = Math.max(1, Math.ceil(total / perPage));
  if(currentPage > totalPages) currentPage = totalPages;
  render();
};

/* --- render table --- */
function render(){
  const q = (searchInput.value || "").toLowerCase();
  const all = getData().filter(r =>
    (r.name || "").toLowerCase().includes(q) ||
    (r.phone || "").includes(q)
  );

  const total = all.length;
  const totalPages = Math.max(1, Math.ceil(total / perPage));
  if(currentPage > totalPages) currentPage = totalPages;

  const start = (currentPage - 1) * perPage;
  const page = all.slice(start, start + perPage);

  tbody.innerHTML = "";
  for(const r of page){
    const dt = r.date || "";
    const safeName = (r.name || "").replaceAll("<","&lt;").replaceAll(">","&gt;");
    const safeAddr = (r.address || "").replaceAll("<","&lt;").replaceAll(">","&gt;");
    const safePhone = (r.phone || "").replaceAll("<","&lt;").replaceAll(">","&gt;");
    const safeExchange = (r.exchange || "").replaceAll("<","&lt;").replaceAll(">","&gt;");
    const safeCtype = (r.ctype || "").replaceAll("<","&lt;").replaceAll(">","&gt;");
    const safeStatus = (r.status || "").replaceAll("<","&lt;").replaceAll(">","&gt;");
    const safeRemarks = (r.remarks || "").replaceAll("<","&lt;").replaceAll(">","&gt;");

    tbody.insertAdjacentHTML("beforeend", `
      <tr>
        <td>${dt}</td>
        <td>${safeName}</td>
        <td>${safeAddr}</td>
        <td>${safePhone}</td>
        <td>${safeExchange}</td>
        <td>${safeCtype}</td>
        <td>${safeStatus}</td>
        <td>${safeRemarks}</td>
        <td>
          <button class="btn small" onclick="editRecord('${r.id}')">Edit</button>
          <button class="btn small secondary" onclick="deleteRecord('${r.id}')">Del</button>
        </td>
      </tr>
    `);
  }

  totalCountEl.textContent = total;
  pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
  prevBtn.disabled = currentPage === 1;
  nextBtn.disabled = currentPage === totalPages;
}

/* --- pagination --- */
prevBtn.addEventListener("click", ()=>{
  if(currentPage > 1) { currentPage--; render(); }
});
nextBtn.addEventListener("click", ()=>{
  const total = getData().length;
  const totalPages = Math.max(1, Math.ceil(total / perPage));
  if(currentPage < totalPages){ currentPage++; render(); }
});

/* --- search --- */
searchInput.addEventListener("input", ()=>{
  currentPage = 1;
  render();
});

/* --- CSV --- */
exportCsv.addEventListener("click", ()=>{
  const arr = getData();
  if(arr.length === 0){ alert("No data to export"); return; }
  let csv = "Date,Name,Address,Phone,Exchange,Type,Status,Remarks\n";
  arr.forEach(r=>{
    // escape double quotes
    const cells = [
      r.date || "",
      r.name || "",
      r.address || "",
      r.phone || "",
      r.exchange || "",
      r.ctype || "",
      r.status || "",
      r.remarks || ""
    ].map(c => `"${(c+"").replace(/"/g,'""')}"`);
    csv += cells.join(",") + "\n";
  });
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "records.csv";
  a.click();
  URL.revokeObjectURL(a.href);
});

/* --- PDF (print) --- */
exportPdf.addEventListener("click", ()=>{
  const arr = getData();
  if(arr.length === 0){ alert("No records"); return; }
  const w = window.open("");
  w.document.write(`<html><head><title>Foot Fails / Inquiry Records</title></head><body>`);
  w.document.write(`<h2>Foot Fails / Inquiry Records</h2>`);
  w.document.write(`<table border="1" style="width:100%; border-collapse:collapse;">`);
  w.document.write(`<tr>
      <th>Date</th><th>Name</th><th>Address</th><th>Phone</th>
      <th>Exchange</th><th>Type</th><th>Status</th><th>Remarks</th>
    </tr>`);
  arr.forEach(r=>{
    const cells = [
      r.date || "",
      r.name || "",
      r.address || "",
      r.phone || "",
      r.exchange || "",
      r.ctype || "",
      r.status || "",
      r.remarks || ""
    ].map(c => `<td>${(c+"").replaceAll("<","&lt;").replaceAll(">","&gt;")}</td>`).join("");
    w.document.write(`<tr>${cells}</tr>`);
  });
  w.document.write(`</table></body></html>`);
  w.document.close();
  w.print();
});

/* --- initial render --- */
render();
</script>

</body>
</html>
